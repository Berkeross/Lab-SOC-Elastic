<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='https://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Exported Article from QuillBot</title></head><body><p style="font-size: 16px"># GUIDE</p><p style="font-size: 16px">En este repositorio voy a explicar paso a paso como descargar, instalar e implementar estas máquinas virtuales y conectarlas entre si para tener un laboratorio SOC/SIEM.</p><p style="font-size: 16px">### REQUISITOS DE SISTEMA</p><p style="font-size: 16px">Dentro de VirtualBox utilicé 4 máquinas virtuales abiertas simultáneamente, de las cuales 2 fueron máquinas Windows.</p><p style="font-size: 16px">Teniendo en cuentas esto utilice aproximadamente:</p><p style="font-size: 16px">* 8GB de Memoria RAM (2GB para cada maquina).</p><p style="font-size: 16px">* 6 hilos(GPU), 2 hilos para las maquinas win ademas 1 hilo para Ubuntu y 1 mas para PFsense.</p><p style="font-size: 16px">* 50GB de disco para Win-Server, 50GB para Win-10, 10GB para PFsense y 50GB para Linux/Ubuntu.</p><p style="font-size: 16px">&gt; [!NOTE]</p><p style="font-size: 16px">&gt; Cabe aclarar que no es estricto, si es necesario agregarle mas y disminuirle la cantidad, el funcionamiento va a ser el mismo.</p><p style="font-size: 16px">### MAQUINAS</p><p style="font-size: 16px">Para virtualizar estas 4 maquinas virtuales se requiere de un virtualizador, en esta guia se utiliza <strong>VirtualBox</strong>. pero se puede usar cualquier otro programa con las lismas carateristicas.</p><p style="font-size: 16px">Se van a ejecutar 4 maquinas virtuales en total utilizando, estas van a ser:</p><p style="font-size: 16px">- Una maquina virtual con [PFsese](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://www.pfsense.org/download/">https://www.pfsense.org/download/</a>)</p><p style="font-size: 16px">- Una maquina virtual con [Windows Server 2022](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://www.microsoft.com/es-es/evalcenter/download-windows-server-2022">https://www.microsoft.com/es-es/evalcenter/download-windows-server-2022</a>)</p><p style="font-size: 16px">- Una maquina virtual con [Windows 10](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://www.microsoft.com/es-es/software-download/windows10">https://www.microsoft.com/es-es/software-download/windows10</a>)</p><p style="font-size: 16px">- Una maquina virtual con [Linux Ubuntu](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://ubuntu.com/download/desktop">https://ubuntu.com/download/desktop</a>)</p><p style="font-size: 16px">### RED</p><p style="font-size: 16px">Dentro de VirtualBox utilizaremos 2 tipos de redes:</p><p style="font-size: 16px">* Una es la red WAN para dar internet.</p><p style="font-size: 16px">* Y la red LAN que viene por defecto en VirtualBox.</p><p style="font-size: 16px">## INSTALACION Y CONFIGURACION DE MAQUINAS</p><p style="font-size: 16px">### &lt;ins&gt;PFsense&lt;/ins&gt;</p><p style="font-size: 16px">Luego de descargar PFsense, hay que seleccionar boton de "nuevo" en Virtual box, se elige el archivo $.iso$ y se coloca como "Tipe: Linux" y "Version: other Linux x64".&lt;br/&gt;</p><p style="font-size: 16px">Antes de iniciar la maquina hay que seleccionar con &lt;ins&gt;click derecho&lt;/ins&gt; y ir a configuracion, dentro de configuracion hay que dirigirse a la pestaña &lt;ins&gt;network&lt;/ins&gt; donde se habilita el &lt;ins&gt;adapter2&lt;/ins&gt;, donde se debe cambiar la opcion WAN por INTERNAL NETWORK y en opciones avanzadas busca la opcion <strong>promiscuous mode</strong> y habilita ALLOW ALL y le selecciona a accept.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Ahora se debe iniciar PFsese y dentro de la instalacion selecciona aceptar repetidamente hasta llegar a la <strong>configuracion de red</strong> donde se debe elegir cual sera la $red WAN$ y la $red LAN$, la red WAN sera la red NAT y LA red LAN sera la red del &lt;ins&gt;adapter2&lt;/ins&gt;. luego de eso se elige el disco donde instalar el sistema y se selecciona reboot.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Luego de que se reinicie nos hay que dirigirse a $devices$ luego a $optical units$ y destildamos la opcion donde esta la &lt;ins&gt;.iso&lt;/ins&gt; de PFsense, luego reiniciamos el sistema.&lt;br/&gt;</p><p style="font-size: 16px">Con el sistema y instalado esperamos a que cargue del todo (esto puede tomar aprox 1 minuto o 2), luego de que se termine la carga deverian aparecer 16 opciones.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Para que PFsense detecte cual es cada red se asignan manualmente de esta manera:</p><p style="font-size: 16px">* Elegimos la opcion 1.</p><p style="font-size: 16px">* En la opcion de VLANs damos simplemente enter</p><p style="font-size: 16px">* Cuando pida identificar la red WAN hay que elegir la opcion que este configurado en Vbox como Adapter1 </p><p style="font-size: 16px">* Cuando pida identificar la red LAN hay que elegir la opcion que este configurada en Vbox como Local Network que en este caso seria Adapter2</p><p style="font-size: 16px">&lt;/br&gt;</p><p style="font-size: 16px">&gt; [!NOTE]</p><p style="font-size: 16px">&gt; Teniendo en cuenta como identifica las redes PFsense se puede definir que Adapter1=em0 - Adapter2=em1 - Adapter3=em2 - Adapter4=em3. Siempre teniendo en cuenta que estamos utilizando Virtual Box. </p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Cuando se termine de configurar hay que ir a la opcion 2 donde:&lt;br/&gt;</p><p style="font-size: 16px">* Seleccionaremos la red lan con una opcion numerica.</p><p style="font-size: 16px">* Luego elegiremos la IP de la LAN (Ej: 192.168.1.1).</p><p style="font-size: 16px">* Luego la mascara que sera de 24.</p><p style="font-size: 16px">* En la Opcion de ingresar una IP Gatewat simplemente se le da al boton enter.</p><p style="font-size: 16px">* En la opcion de ingresar una IP V6 se da enter nuevamente.</p><p style="font-size: 16px">* Y cuando se solicite elegir si queremos DHCP para la red LAN damos "Y"</p><p style="font-size: 16px">* El rango IP para el DHCP empesaria (utilizando el ejemplo anterior) con 192.168.1.2 a 192.168.1.10, luego damos enter y esperamos a que se guarden los cambios.</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Cuando se termine de configurar no va a adar una direccion web que utilisando el ejemplo anterior quedaria "<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://192.168.1.1/">http://192.168.1.1/</a>" y con eso ya estaria terminada la configuracion de PFsense.&lt;/br&gt;</p><p style="font-size: 16px">&lt;/br&gt;</p><p style="font-size: 16px">&gt; [!IMPORTANT]</p><p style="font-size: 16px">&gt; para logearse en la pagina de PFsense utilice Login: Admin y Password: pfsense.</p><p style="font-size: 16px">### &lt;ins&gt;Windows Server&lt;/ins&gt;</p><p style="font-size: 16px">Al colocar la ISO de Windows Server esta se configura de manera automatica, para evitar esto destildaremos la opcion &lt;ins&gt;Skip Unattended Installation&lt;/ins&gt; para poder configurarlo manualmente, colocamos las especificaciones mencionadas en "requisitos del sistema".&lt;br/&gt;</p><p style="font-size: 16px">Antes de iniciar la maquina hay que ir a la configuracion y en la opcion de network elegiremos en Adapter1 la opcion de "**Internal Network**".&lt;br/&gt;</p><p style="font-size: 16px">Al iniciar la instalacion dejaremos el lenguaje del sistema en ingles, luego elegiremos la opcion "Windows Server 2022 Datacenter Evolution (Desktop Edition)" y para finalizar elegiremos la opcion custom install y elegiremos el drive0 para que finalice la instalacion. Antes de reiniciarse te pedira una contraseña para establecer el administrador la cual es a gusto propio.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Ya con la instalacion finalizada hay que logearse con la cuenta de administrator, ya en el inicio dejamos que se inicie el $Server Manager$ y nos dirigimos a:</p><p style="font-size: 16px">* network Conections</p><p style="font-size: 16px">  * Click derecho a Properties</p><p style="font-size: 16px">    * doble click a Internet Protocol V4&lt;br/&gt;</p><p style="font-size: 16px">    </p><p style="font-size: 16px">Aca configure la direccion IP manualmente con con alguna IP dentro del rango DHCP, coloque una mascara de /24, la gateway va a ser la ip de la red LAN y el servidor DNS va a ser la misma quecoloque como direccion IP, tambien como DNS secundaria se puede poner alguna de las bien conocidas como google:8.8.8.8 o 4.4.8.8.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Para probar que la coneccion es estable se puede ingresar al servicio interno PFsense que te da al finalizar la configuracion (en el ejemplo seria "<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://192.168.1.1/">http://192.168.1.1/</a>") si esta entra quiere decir que la coneccion esta establecida y que la red LAN funciona correctamente.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">&gt; [!TIP]</p><p style="font-size: 16px">&gt; para mas comodidad a la hora de indentificar las maquinas, se puede cambiar el nombre dirigendote al buscador: About your PC -&gt; Rename This PC y cambiarlo a por ejemplo (WIN-AD), esto nos va a servir mas adelante.</p><p style="font-size: 16px">Una vez conectado, hay que crear un servidor dedicado de <strong>Active Directory</strong>. Para esto vamos al $Server Manager$ y nos dirigimos a:</p><p style="font-size: 16px">* Add Roles and Features.</p><p style="font-size: 16px">  * Next tres veces seguidas.</p><p style="font-size: 16px">    * Buscamos y tildamos "Active Directory Domain Service".</p><p style="font-size: 16px">      * Add Features.</p><p style="font-size: 16px">        * Siguiente tres veces mas.</p><p style="font-size: 16px">          * Install.</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Esperamos a que se termine de intalar y "cerrar". Luego seleccionamos el vanderin que se encuentra en la parte superior izquierda y dirigirnos a la opcion de "Promote this server to a domain controller", Los siguentes pasos son:&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">* Selecciona "Add New Forest"</p><p style="font-size: 16px">  * En "Root Domain Name" coloca un nombre de dominio como "soc.lab" o "prueba.local" y luego al boton "next".</p><p style="font-size: 16px">    * elegimos una contraseña y la colocamos, luego repetimos en "Confirm Password" y le damos a Next.</p><p style="font-size: 16px">      * Dejar la parte DNS por defecto y Next.</p><p style="font-size: 16px">        * El NetBIOS lo escribimos en fisico como en un papel par recordarlo y Next.</p><p style="font-size: 16px">          * Las siguientes dos opciones las dejamos por defecto y Next.</p><p style="font-size: 16px">            * Le damos a instalar y reiniciamos cuando se le solicite.</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Una vez reiniciado el Active Directory quedara activo.</p><p style="font-size: 16px">### &lt;ins&gt;Windows 10&lt;/ins&gt;</p><p style="font-size: 16px">Luego de probar el funcionamiento de la Red LAN en Windows Server, realizaremos el mismo proceso de instalacion con Windows 10. Antes de iniciar la máquina, hay que ir a la configuración y en la opción de network elegiremos en Adapter1 la opción de "**Internal Network**".&lt;br/&gt;</p><p style="font-size: 16px">Al momento de instalar dejaremos el lenguaje del sistema en ingles, la opcion de windows sin KEY y la opcion de "Win-10 pro".&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Ya con la instalacion finalizada hay que logearse, ya en el inicio nos dirigimos a:</p><p style="font-size: 16px">* network Conections</p><p style="font-size: 16px">  * Click derecho a Properties</p><p style="font-size: 16px">    * doble click a Internet Protocol V4&lt;br/&gt;</p><p style="font-size: 16px">Aca configure la direccion IP manualmente con con alguna IP dentro del rango DHCP diferente a la que le dio a Win-Server, coloque una mascara de /24, la gateway va a ser la ip de la red LAN y el servidor DNS va a ser la misma direccion IP que tiene Win-Server.&lt;br/&gt;</p><p style="font-size: 16px">Para probar que la coneccion es estable se puede ingresar al servicio interno PFsense que te da al finalizar la configuracion (en el ejemplo seria "<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://192.168.1.1/">http://192.168.1.1/</a>") si puede acceder quiere decir que la coneccion esta establecida y que la red LAN funciona correctamente.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Una vez conectado a la red nos vamos a dirigir a:&lt;br/&gt;</p><p style="font-size: 16px">* Settings.</p><p style="font-size: 16px">  * About your PC.</p><p style="font-size: 16px">cambiaremos el nombre a uno mas mas facil de recordar y &lt;ins&gt;reinicie la PC&lt;/ins&gt;. Una vez reiniciado nos dirigimos al mismo lugar y busca la opcion "Advanced System Settings", allí elegimos la opcion de cambiar nombre de dominio, y en la opcion "Member of Domain:" escribimos el "**NetBIOS**" que guarmamos anteriormente, una vez colocado le solicitara un nombre y contraseña de ese dominio y va a utilizar la cuenta de administrador que uso para logearse a Windows Server. Una vez dentro del Dominio le da a "ok" y reinicie cuando se le solicite.</p><p style="font-size: 16px">De esta forma estara dentro del dominio y conectado a Windows server.</p><p style="font-size: 16px">### &lt;ins&gt;Linux/Ubuntu&lt;/ins&gt;</p><p style="font-size: 16px">Una vez active Directory (Windows Server) este conectado con la maquina win10 hay que crear la zona de monitoreo SIEM. Para esto crea la maquina virtual con la configuracion indicada en "Requisitos del Sistema". Antes de iniciar la maquina hay que ir a la configuracion y en la opcion de network elegiremos en Adapter1 la opcion de "**Internal Network**".&lt;br/&gt;</p><p style="font-size: 16px">SIgue la instalacion y al ingresar al desktop configura la red. La misma se configura en el boton en la parte superior izquierda dirigiendote a:&lt;br/&gt;</p><p style="font-size: 16px">* Wired Connected.</p><p style="font-size: 16px">  * Wired Settings.</p><p style="font-size: 16px">    * Dirigete a la "tuerca"</p><p style="font-size: 16px">      * Dirigete a la pestaña "IPv4"</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Aqui configure la direccion IP manualmente con con alguna IP dentro del rango DHCP diferente a la que le dio a Win-Server y Win10, coloque una mascara de /24, la gateway va a ser la ip de la red LAN y el servidor DNS va a ser la misma direccion IP que tiene Win-Server.&lt;br/&gt;</p><p style="font-size: 16px">Para probar que la coneccion es estable se puede ingresar al servicio interno PFsense que te da al finalizar la configuracion (en el ejemplo seria "<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://192.168.1.1/">http://192.168.1.1/</a>") si puede acceder quiere decir que la coneccion esta establecida y que la red LAN funciona correctamente.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">## ElasticSIEM</p><p style="font-size: 16px">Para INstalar <strong>ElasticSIEM</strong> se requiere de 3 sistemas lso cuales serias java, ekastic y kibana respectivamente. Estos se instalan en la terminal de linux con con los siguientes comandos.</p><p style="font-size: 16px">Instalamos Primero Java con el comando:</p><p style="font-size: 16px">	sudo apt update &amp;&amp; sudo apt upgrade -y</p><p style="font-size: 16px">	sudo apt install -y openjdk-17-jdk</p><p style="font-size: 16px"> </p><p style="font-size: 16px">Despues descargamos e instalamos elastic con el comando:</p><p style="font-size: 16px">	wget <a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.9.0-amd64.deb">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.9.0-amd64.deb</a></p><p style="font-size: 16px">	sudo dpkg -i elasticsearch-8.9.0-amd64.deb</p><p style="font-size: 16px">Y habilitamos amobos sistemas, primero elastic:</p><p style="font-size: 16px">	sudo systemctl enable elasticsearch</p><p style="font-size: 16px">	sudo systemctl start elasticsearch</p><p style="font-size: 16px"> </p><p style="font-size: 16px">&gt; [!TIP]</p><p style="font-size: 16px">&gt; Para verificar si el prigrama corre correctamente se puede utilizar: 	"[sudo systemctl status elasticsearch]".</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Despues de instalar Elastic hay que &lt;ins&gt;configurarlo&lt;/ins&gt;. este se encuenctran en la ruta "[/etc/elasticsearch/elasticsearch.yml]" y se pueden editar utilizando el comando $nano$:</p><p style="font-size: 16px">	sudo nano /etc/elasticsearch/elasticsearch.yml</p><p style="font-size: 16px"> Dentro del archivo de configuracion, busca las siguientes lineas a editar:</p><p style="font-size: 16px"> 	#<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://network.host">network.host</a>: "192.168.0.1"</p><p style="font-size: 16px">  	#http.port: 9200</p><p style="font-size: 16px">   	#<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://xpack.security">xpack.security</a>.http.ssl:</p><p style="font-size: 16px">	  enabled: true</p><p style="font-size: 16px">    #<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://xpack.security">xpack.security</a>.transport.ssl:</p><p style="font-size: 16px">	  enabled: true</p><p style="font-size: 16px">&gt; [!IMPORTANT]</p><p style="font-size: 16px">&gt; Todas las lineas del archivo .yml que contengan &lt;ins&gt;"#"&lt;/ins&gt; van a quedar como configuracion prdeterminada. a las lineas a editar se le deve quitar el #.</p><p style="font-size: 16px">Estas lineas las vas a configuar copiando estas lineas indicadas del archivo de [Configuración Elastic](Documentación/Configuración-Elastic.txt).&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Una vez configruado, se utiliza el comando "[sudo systemctl restart elasticsearch]" para resetear el preograma, el cual tarda uno algunos segundos.</p><p style="font-size: 16px">Una vez reiniciado el prigrama, en el buscador predetermiinado del sistema colocamos "&lt;ins&gt;<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://localhost:9200</ins>">http://localhost:9200&lt;/ins&gt;</a>". al ingresar nos solicitara usuario y contraseña, el cual se consigue con el siguiente comando.</p><p style="font-size: 16px"> 	sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic</p><p style="font-size: 16px">Al utilizarlo en la terminal te dejara un lanea que indica "New value: TU_CONTRASEÑA_ELASTIC", esta sera la nueva contraseña para el usuario "elastic". Esta contraseña guardala en un archivo ".txt" en el escritorio, y al recarlar la url en los espacios de texto se debe llenar con:&lt;br/&gt;</p><p style="font-size: 16px">User: elastic&lt;br/&gt;</p><p style="font-size: 16px">Password : TU_CONTRASEÑA_ELASTIC&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">La pagina te mostrara tu nombre de sistema y algunos datos que indican que esta en funcionamiento.&lt;br/&gt;</p><p style="font-size: 16px">### &lt;ins&gt;Kibana&lt;/ins&gt;</p><p style="font-size: 16px">Una vez terminada la instalacion de elastic descarmamos e instalamos Kibana con el comando:</p><p style="font-size: 16px">	wget <a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://artifacts.elastic.co/downloads/kibana/kibana-8.9.0-amd64.deb">https://artifacts.elastic.co/downloads/kibana/kibana-8.9.0-amd64.deb</a></p><p style="font-size: 16px">	sudo dpkg -i kibana-8.9.0-amd64.deb</p><p style="font-size: 16px">Luego de descargarlo se activa el programa con:</p><p style="font-size: 16px">	sudo systemctl enable kibana</p><p style="font-size: 16px">	sudo systemctl start kibana</p><p style="font-size: 16px">Una vez activo el programa se debe cambiar la contraseña de kibana para acceder a elastic. Para esto utilizamos el comando:</p><p style="font-size: 16px">	sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u kibana_system</p><p style="font-size: 16px"> </p><p style="font-size: 16px">Dejara un lanea que indica "New value: TU_CONTRASEÑA_KIBANA", la cual es la contraseña para el usuario kibana_system. esta contraseña tambien se debe guardar en el archivo .txt para usar mas adelante.&lt;br/&gt;</p><p style="font-size: 16px">Ya con la contraseña se pasa a configurar kibana utiliza el comando "[sudo nano /etc/kibana/kibana.yml]" y buscas las lineas a editar:</p><p style="font-size: 16px">	#server.port: 5601</p><p style="font-size: 16px"> 	#<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://server.host">server.host</a>: ""</p><p style="font-size: 16px">  	#server.publicBaseUrl:</p><p style="font-size: 16px">   	#elasticsearch.hosts: ["<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://localhost:9200">http://localhost:9200</a>"]</p><p style="font-size: 16px">    #elasticsearch.username: "kibana_system"</p><p style="font-size: 16px">	#elasticsearch.password: "pass"</p><p style="font-size: 16px">Estas se deben configurar copiando estas lineas indicadas del archivo de [Configuración Kibana](Documentación/Configuración-Kibana.txt).&lt;br/&gt;</p><p style="font-size: 16px">Una vez configurado se rinician los dos programas:</p><p style="font-size: 16px">	sudo systemctl restart elasticsearch</p><p style="font-size: 16px">	sudo systemctl restart kibana</p><p style="font-size: 16px">Al finalizar los programas pueden tardar en inciarse aproximadamente 2 minutos, luego de ese tiempo tendras [<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://localhost:9200">http://localhost:9200</a>] donde muestra que elastic esta activo y "[&lt;ins&gt;<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="http://localhost:5601</ins>">http://localhost:5601&lt;/ins&gt;</a>]" donde tendras el elastic de forma grafica. Luego de ingresar pulsas el boton que diga "i explorer for my own" y tendra el sistema en completo funcionamiento.</p><p style="font-size: 16px">## sysmon y winlogbeat</p><p style="font-size: 16px">Para poder enviar logs desde Win10 y Win-Server al sistema de elastic hay que conectar ambos sistemas utilizando &lt;ins&gt;Sysmon y Winlogbeat&lt;/ins&gt;. Ambas configuraciones funcionan igual para los dos sistemas con lo cual habra que repetir el proceso por cada sistema.</p><p style="font-size: 16px">### &lt;ins&gt;Sysmon&lt;/ins&gt;</p><p style="font-size: 16px">para este programa hay que descargar [<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon</a>], una vez descargado se extrae en la ruta [C:\Sysmon\]. Ya con la carpeta extraída, descargamos la configuracion siendo este el ultimo componente.&lt;br/&gt;</p><p style="font-size: 16px">&gt; [!NOTE]</p><p style="font-size: 16px">&gt; Este archivo se puede descargar por internet, y hay varias versiones hechas por la comunidad, mayormente se encuentran en GitHub.</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">En esta guia se utiliza una configuracion descargada utilizando la terminal de Powershell como <strong>Administrador</strong> utilizando el comando.</p><p style="font-size: 16px">	Invoke-WebRequest -Uri "<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://raw.githubusercontent.com/SwiftOnSecurity/sysmon-config/master/sysmonconfig-export.xml">https://raw.githubusercontent.com/SwiftOnSecurity/sysmon-config/master/sysmonconfig-export.xml</a>" -OutFile "C:\Sysmon\sysmonconfig.xml"</p><p style="font-size: 16px">Con la configuracion descargada se ejecuta el programa utilizando Powershell como administrador.</p><p style="font-size: 16px">	C:\Sysmon\Sysmon64.exe -accepteula -i C:\Sysmon\sysmonconfig.xml</p><p style="font-size: 16px">Para verificar que Sysmon este en funcionamiento se puede utilizar el siguiente comando, si este no muestra logs o da algun error signica que hubo un problema con la instalación: </p><p style="font-size: 16px">	</p><p style="font-size: 16px"> 	Get-WinEvent -LogName "Microsoft-Windows-Sysmon/Operational" -MaxEvents 10 | Format-List</p><p style="font-size: 16px">Una vez instalado es neceasario enviar los logs que genere Sysmon a Elastic, esto se va a hacer con Winlogbeat el cual se encarga de conectar ambas maquinas virtuales (Win10 y Win_Server) a Elastic.</p><p style="font-size: 16px">### &lt;ins&gt;Winlogbeat&lt;/ins&gt;</p><p style="font-size: 16px">Este programa es compatible con Elastic el cual se puede descargar desde su pagina en [<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://www.elastic.co/downloads/beats/winlogbeat">https://www.elastic.co/downloads/beats/winlogbeat</a>].</p><p style="font-size: 16px">Una vez descargado el archivo .zip se descomprime en la ruta [C:\Program Files\Winlogbeat\]. Dentro de la carpeta busca el archivo winlogbeat.yml y configuralo utilizando el bloc de notas, las lineas a editar o agregar son las siguientes.</p><p style="font-size: 16px">&gt; [!IMPORTANT]</p><p style="font-size: 16px">&gt; Dentro de Windows asi como en Linux tambien todas las lineas del archivo .yml que contengan &lt;ins&gt;"#"&lt;/ins&gt; van a quedar como configuracion prdeterminada. a las lineas a editar se le deve quitar el #.</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px"> 	#winlogbeat.event_logs:</p><p style="font-size: 16px">	  - name: Application</p><p style="font-size: 16px">	  - name: System</p><p style="font-size: 16px">	  - name: Security</p><p style="font-size: 16px">	#host: "localhost:5601"</p><p style="font-size: 16px"> 	#hosts: ["localhost:9200"]</p><p style="font-size: 16px">  	#protocol: "http"</p><p style="font-size: 16px">   	#username: "elastic"</p><p style="font-size: 16px">  	#password: "changeme"</p><p style="font-size: 16px">  	#ssl.verification_mode:</p><p style="font-size: 16px">Las lineas a editar o agregar se encuentran en [Configuración Winlogbeat](Documentación/Configuración-Winlogbeat.txt).&lt;br/&gt;</p><p style="font-size: 16px">Una vez editado el archivo ejecutamos Powershell como administrador y para dirigirse a la carpeta donde esta winlogbeat utilizas el comando:</p><p style="font-size: 16px">	cd 'C:\Program Files\Winlogbeat'</p><p style="font-size: 16px">Ya en el directorio ejecutas:</p><p style="font-size: 16px">	.\install-service-winlogbeat.ps1</p><p style="font-size: 16px"> 	Start-Service winlogbeat</p><p style="font-size: 16px">Luego de instalar podemos verificar de dos formas, una es entrando a Services y buscando el programa, y la otra opcion es ejecutar en pshell como admin. este comando: ".\winlogbeat.exe setup -e" el cual muestra los logs recogidos por el programa.</p><p style="font-size: 16px">### &lt;ins&gt;Coneccion con Elastic&lt;/ins&gt;</p><p style="font-size: 16px">Cuando ambos sistemas operativos tengan instalado sysmon y winlogbeat se deven implementar en elasticSIEM.</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Dentro de ElasticSIEM dirigete a [ Menú lateral → Analytics → Discover ] y selecciona "&lt;ins&gt;Add Itegrations&lt;/ins&gt;". luego de agregar esta ingregacion vas a ver en la pestaña &lt;ins&gt;discover&lt;/ins&gt; sobre la parte superior izquierda una pestaña que muestra los <strong>Data View</strong>, en esa pestaña busca el recuadro de "&lt;ins&gt;Winlogbeat-*&lt;/ins&gt;".&lt;br/&gt;</p><p style="font-size: 16px">$Winlogneat-*$ muestra los log de los sistemas Windows en una sola pestaña, en esta se ve una [TimeLine](Capturas/Captura-Logs-1.png) en la cual se va mostrando la cantidad de [alertas](Capturas/Captura-Logs-2.png) que muestra winlogbeat a lo largo del tiempo.&lt;br/&gt;</p><p style="font-size: 16px">Por otro lado dirigiendote a [ Menú lateral → Security → Alerts ] donde se encunetra la informacion de estas [alertas](Capturas/Captura-Alertas-1.png) en las cuales [filtra y categoriza](Capturas/Captura-Alertas-2.png) las mismas para una mejor deteccion.&lt;br/&gt;</p><p style="font-size: 16px">Contando con estas dos funciones mas otras que ya vienen integradas en el paquete ElasticSIEM es posible hacer pruebas de ataques simulados.</p><p style="font-size: 16px">## Simulación de ataques</p><p style="font-size: 16px">Teniendo un Entorno SIEM funcional es momento de comprometerlo para comprobar sus funcionalidades. Para esto se va a utilizar &lt;ins&gt;**BadBlood**&lt;/ins&gt; para comprometer Windows Server y &lt;/ins&gt;**Atomic Red Team**&lt;/ins&gt; para comprometer Windows 10.</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">### &lt;ins&gt;BadBlood&lt;ins&gt;</p><p style="font-size: 16px">Badblood es un  malware sencillo de descargar e instalar, para realizar la descarga ingresa al link de [GitHub](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://github.com/davidprowe/BadBlood">https://github.com/davidprowe/BadBlood</a>), descargue el .zip y extraiga el contenido en el lugar.&lt;br/&gt;</p><p style="font-size: 16px">Una vez extraigo ingrese como administrador a powershell y ejecute los siguientes comandos:</p><p style="font-size: 16px"> 	cd .\Downloads\BadBlood-Master\BadBlood-Master\</p><p style="font-size: 16px">Luego de ingresar a la carpeta del malware, este se ejecuta con:</p><p style="font-size: 16px">	.\invoke-BadBlood.ps1</p><p style="font-size: 16px">Con esto aparecera un pequeño parrafo explicativo guia para ejecutarlo. Una vez ejecutado deja que la magia suceda (esto puede tomar varios minutos).&lt;br/&gt;</p><p style="font-size: 16px">Una vez terminado le proceso en ElasticSIEM en la pestaña de $Discover$ deverian haber ingresado varios log y eventos relacionados con la creacion de usuarios roles y eventos en Win-Server.</p><p style="font-size: 16px">### &lt;ins&gt;Atomic Red Team&lt;/ins&gt;</p><p style="font-size: 16px">Atomic Red Team es un programa un poco mas compleja de instalar y ejecutar. Priemro es necesario desactivar windows defender, para esto hay que dirigierse a [&lt;ins&gt; Menú del buscador → Settings → Update &amp; Security → Windows Defender → Virus &amp; threat Protection → Virus &amp; threat Protection Settings → Manage Settings &lt;/ins&gt;] En esta pestaña descativa todas las opciones. Una vez desactivado el ultimo paso es ejecutar el comando:</p><p style="font-size: 16px">	Set-MpPreference -DisableRealtimeMonitoring $true</p><p style="font-size: 16px"> Despues para que Powershell pueda instalar las dependencias necesita el modulo ".yaml" el cual se instala con: </p><p style="font-size: 16px"> 	Install-Module powershell-yaml -Force -Scope CurrentUser</p><p style="font-size: 16px">	Import-Module powershell-yaml</p><p style="font-size: 16px">Con el antivirus completamente desactivado se debe descargar dos carpetas la primera es [atomic-red-team-master](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://github.com/redcanaryco/atomic-red-team.git">https://github.com/redcanaryco/atomic-red-team.git</a>) y [invoke-atomicredteam-master](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://github.com/redcanaryco/invoke-atomicredteam.git">https://github.com/redcanaryco/invoke-atomicredteam.git</a>), ambos se encuenctran en github descargando el archivo .zip.&lt;br/&gt;</p><p style="font-size: 16px">Antes de extraerlos se debe crear una carpeta con nombre "AtomicRedTeam" en la carpeta "C:\" (disco local). Estos archivos descargados se deben descomprimir en la carpeta AtomicRedTeam, alli deveria quedar:</p><p style="font-size: 16px">	</p><p style="font-size: 16px"> 	C:\AtomicRedTeam\</p><p style="font-size: 16px">	    └── atomic-red-team-master\</p><p style="font-size: 16px">	    ├    └── atomic-red-team-master\</p><p style="font-size: 16px">	    ├    	├── .devcontainer\</p><p style="font-size: 16px">	    ├    	├── atomics\</p><p style="font-size: 16px">     	    ├		└── ...\	</p><p style="font-size: 16px">	    └── invoke-atomicredteam-master\</p><p style="font-size: 16px">	         	└── invoke-atomicredteam-master\</p><p style="font-size: 16px">	         		├── .git\</p><p style="font-size: 16px">	    			├── doker\</p><p style="font-size: 16px">	         		└── ...</p><p style="font-size: 16px"> </p><p style="font-size: 16px">Como se puede ver ambos archivos al extraerlos crean una carpeta del mismo nombre dentro de su propia carpeta con el contenido necesario. Para evitar problemas con los comandos que se deben ejecutar, se debe quitar la carpeta intermedia con nombre repetido para tener una ruta mas corta, ademas de mover la carpeta "\atomics" a la ruta "C:\AtomicRedTeam\", esto deveria quedar asi:</p><p style="font-size: 16px">  	C:\AtomicRedTeam\</p><p style="font-size: 16px">	    ├── atomic-red-team-master\</p><p style="font-size: 16px">     	    ├	 └── .devcontainer\</p><p style="font-size: 16px">	    ├	 └── ...</p><p style="font-size: 16px">	    ├── atomics\</p><p style="font-size: 16px">     	    ├	 └── indexes\</p><p style="font-size: 16px">	    ├	 └── ...</p><p style="font-size: 16px">	    └── invoke-atomicredteam-master\</p><p style="font-size: 16px">	         └── .git\</p><p style="font-size: 16px">	         └── ...</p><p style="font-size: 16px">Una vez las carpetas esten colocadas correctamentesse deve instalar, en este repositorio se explicara el paso a paso de esta version, en caso de encontrarte con un error nno dudes en consultar con la [Wiki](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://github.com/redcanaryco/invoke-atomicredteam/wiki">https://github.com/redcanaryco/invoke-atomicredteam/wiki</a>) de AtomicRedTEam. Primero se debe ingresar a powershell como administrador y ejecutar:</p><p style="font-size: 16px">	powershell -exec bypass</p><p style="font-size: 16px">Luego de que se recargue powershell se deve ejecutar:</p><p style="font-size: 16px">	Install-Module -Name invoke-atomicredteam,powershell-yaml -Scope CurrentUser</p><p style="font-size: 16px">Finalizada la instalacion de modulo se debe verificar que se instalo correctamente con el codigo:</p><p style="font-size: 16px">	get-module</p><p style="font-size: 16px"> Si al ejecutarlo aparece "Invoke-AtomicRedTeam" en la lista de modulos quiere decir que el programa se instalo satisfactoriamente. Para poder simular un ataque es necesario ingresar un codigo, este codigo es el que se usa para categorizar ataques en la organizacion ["MITRE ATT&amp;CK"](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://attack.mitre.org/matrices/enterprise/).<br/>">https://attack.mitre.org/matrices/enterprise/).&lt;br/&gt;</a></p><p style="font-size: 16px">&gt; [!NOTE]</p><p style="font-size: 16px">&gt; el link que esta atado a MITRE ATT&amp;CK lleva a un cuadro con todos lo ataques categorizados, si a estos le pasas el mause por encima veras un codifo como "T1548" o "T1016", estos son los codigos utilizados para lanzar ataques con Atomic Red Team.</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Para iniciar un ataque se debe utilizar el comando "Invoke-AtomicTest" seguido de un código de ataque. Tambien se le puede agregar tags al final de la linea como por ejemplo "-ShowDetailsBrief"  que muestra una lista de funciones del ataque en concreto o "-CheckPrereqs" el cual muestra una lista de rewuisitos para que se pueda ejecutar el ataque (mayormente siempre se cumplen los requisitos ya que son programas que vienen incluidos con windows).&lt;br/&gt;</p><p style="font-size: 16px">Para poder generar logs ejecuta algunos ataque los cuales tendrian que salir en ElasticSIEM, tambien mencionar que en caso de algun error en el proceso se puede verificar utilizando el [video de YT](<a target="_blank" rel="noopener noreferrer" class="qbe-widget" href="https://www.youtube.com/watch?v=_xW3fAumh1c">https://www.youtube.com/watch?v=_xW3fAumh1c</a>) que se utilizo para hacer la parte de Atomic en esta guia.</p><p style="font-size: 16px">## Pasos finales y Practica</p><p style="font-size: 16px">Luego de tener ejecutados ambos malwares en los sistemas operativos, siendo BadBlood en Win-Server y algun ataque a eleccion en Atomic Red Team, se va a tener acceso a gran cantidad de logs generados que envia Winlogbeat a ElasticSIEM, con estos se puede hacer el seguimiento para verficar como se desarrolla un malware en un entonrno controlado y cuales son sus paso a paso para lograr infectar un Sistema Operativo.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Dentro de la parte <strong>practica</strong>, se puede explorar el sistema Elastica para conocer todas sus funcionos, a modo personal para realizar esta guia le solicite a <strong>&lt;ins&gt;ChatGPT&lt;/ins&gt;</strong> que me de desafios en los cuales me indicara que malware ejecutar en AtomicRedTeam y responder una serie de preguntas.&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">&lt;br/&gt;</p><p style="font-size: 16px">Con un sistema SIEM com Elastic se pueden realizar gran cantida de acciones con las cuales se puede aprendender con cada prueba que se hace. Este proyecto no es una solución definitiva, sino un entonrno para practicar y mejorar en el proceso. Si llegaste hasta acá, o si te sirve de inspiración para construir tu propio laboratorio SOC, significa que  valió la pena. ya que lo que me mueve es la curiosidad constante y las ganas de seguir aprendiendo.</p><p style="font-size: 16px"></p></body></html>